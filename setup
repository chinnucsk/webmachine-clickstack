# -*-shell-script-*-

# Install everything from pkg_dir
cp -a $pkg_dir/* $app_dir/


# Create a start script that runs Python's SimpleHTTPServer (this will
# serve the directory contents over HTTP on $app_port)

cat > "$control_dir/start" << EOF
#!/bin/sh
cd $app_dir
export WEBMACHINE_PORT=$app_port
export $(cat $app_dir/.genapp/control/env)
exec ./start.sh
EOF

# start must be executable
chmod 755 "$control_dir/start"
chmod 755 "$app_dir/start.sh"

# compile the app, removing any existing beam files
cd $app_dir
rm $app_dir/ebin/*.beam
find $app_dir/deps/ -type f -name *.beam | xargs rm
make
